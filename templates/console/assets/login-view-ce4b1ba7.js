import{r as s,U as L,w as T,j as e,z as I,a7 as R,a8 as _,a9 as D,S as u,T as l,aa as m,Q as A,a5 as F,ab as U}from"./index-0bc08c43.js";import{u as $}from"./use-router-ed9ae2ce.js";import{E as z,L as B}from"./ErrorMessage-65cf6e66.js";import{C as G}from"./CircularProgress-ad77ea3d.js";import{T as p}from"./TextField-2bac030f.js";import{I as M}from"./InputAdornment-e699fd8f.js";function Z(){const[r,g]=s.useState(""),[i,x]=s.useState(""),[f,t]=s.useState(""),{setToken:h,setEmail:w}=s.useContext(L),[b,o]=s.useState(!1),[j,y]=s.useState(!1),v=T(),S=$(),[d,P]=s.useState(!1),k=async n=>{if(n.preventDefault(),o(!0),!/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]{2,7}$/.test(r)){o(!1),t("Please enter a valid email address");return}if(typeof i!="string"){t("Password must be a string");return}if(i.length<8){o(!1),t("Password must be at least 8 characters long");return}if(!r||!i){o(!1),t("Email and password cannot be empty");return}const E={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(`grant_type=&username=${r}&password=${i}&scope=&client_id=&client_secret=`)};try{const a=await U(E),c=await a.json();console.log(a),console.log(c),a.ok?(h(c.access_token),S.push("/")):t(c.detail),a.status===401&&(w(r),y(!0))}catch(a){t(`An error occurred. Please try again. ${a}`)}finally{o(!1)}},C=e.jsxs(e.Fragment,{children:[e.jsxs(u,{spacing:3,children:[e.jsx(p,{name:"email",label:"Email address",onChange:n=>g(n.target.value)}),e.jsx(p,{name:"password",label:"Password",onChange:n=>x(n.target.value),type:d?"text":"password",InputProps:{endAdornment:e.jsx(M,{position:"end",children:e.jsx(A,{onClick:()=>P(!d),edge:"end",children:e.jsx(F,{icon:d?"eva:eye-fill":"eva:eye-off-fill"})})})}})]}),e.jsx(z,{message:f}),j&&e.jsxs(l,{variant:"body2",sx:{mt:2,mb:5},children:["Didn't receive verification code? ",e.jsx(m,{to:"/verification",variant:"subtitle2",children:"Resend"})]}),e.jsx(B,{fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"inherit",loading:b,onClick:k,children:"Login"}),e.jsx(l,{component:m,to:"/forgot_password",variant:"body2",sx:{mt:1,mb:2,color:"#ff0000",textDecoration:"none",cursor:"pointer"},children:"Forgot Password?"})]});return e.jsxs(I,{sx:{...R({color:_(v.palette.background.default,.9),imgUrl:"/assets/background/overlay_4.jpg"}),height:1},children:[e.jsx(D,{sx:{position:"fixed",top:{xs:16,md:24},left:{xs:16,md:24}}}),e.jsx(u,{alignItems:"center",justifyContent:"center",sx:{height:1},children:e.jsxs(G,{sx:{"&::-webkit-scrollbar":{display:"none"},p:5,width:1,maxWidth:420},children:[e.jsx(l,{variant:"h4",mb:4,children:"Sign in to Genbase"}),C,e.jsxs(l,{variant:"body2",sx:{mt:5,mb:2},children:["Don’t have an account? ",e.jsx(m,{to:"/signup",variant:"subtitle2",style:{textDecoration:"none"},children:"Get started"})]})]})})]})}export{Z as default};
